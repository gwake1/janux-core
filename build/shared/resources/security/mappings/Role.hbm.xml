<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
		"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"
>
<!-- CVS: $Id: Role.hbm.xml,v 1.4 2007-01-11 23:13:10 philippe Exp $ -->
<hibernate-mapping package="org.janux.security" >

<class name="RoleImpl" table="sec_role">
	<meta attribute="implements">Role</meta>

	<meta attribute="class-description">Roles are hierarchical constructs that
	aggregate Permissions and other Roles; for example, a ROLE_PRODUCT_MANAGER
	Role may be created comprising Create/Read/Update/Delete Permissions to
	Product objects, a ROLE_CONTENT_MANAGER may be created comprising
	Create/Read/Update/Delete Permissions to marketing content, and a
	ROLE_SUPERVISOR may be created that encompasses the ROLE_PRODUCT_MANAGER and
	the ROLE_CONTENT_MANAGER plus the permission to publish content.
	</meta>

	<id name="id" type="java.lang.Integer" unsaved-value="-1">
		<meta attribute="use-in-tostring">true</meta>
		<generator class="native"/>
	</id>

	<property name="name" type="string" not-null="true" unique="true">
		<meta attribute="use-in-tostring">true</meta>
		<meta attribute="use-in-equals">true</meta>
	</property>

	<property name="description" type="text">
		<meta attribute="field-description">Human readable description of this Role</meta>
	</property>

	<property name="sortOrder" type="java.lang.Integer">
		<meta attribute="use-in-tostring">true</meta>
	</property>

	<property name="enabled" type="boolean">
		<meta attribute="use-in-tostring">true</meta>
		<column name="enabled" not-null="true" default="1"/>
	</property>


	<map name="permissionsGranted"
		table="sec_permission_granted"
		lazy="false"
	>
		<meta attribute="field-description">Indicates the Permissions granted to the containing Role, in the context of a AuthorizationContext</meta>
		<key column="roleId" foreign-key="fk_role__permission_granted"/>

		<composite-map-key class="PermissionGrantedKey">

			<key-property name="deny" type="boolean">
				<meta attribute="use-in-equals">true</meta>
				<meta attribute="use-in-tostring">true</meta>
				<column name="deny" not-null="true" default="0"/>
			</key-property>

			<key-many-to-one 
				name="authorizationContext" 
				class="org.janux.security.metadata.AuthorizationContextImpl" 
				foreign-key="fk_permission_granted__authorization_context"
				lazy="false"
			>
				<meta attribute="use-in-equals">true</meta>
				<meta attribute="use-in-tostring">true</meta>
				<column name="contextId" not-null="true"/>
			</key-many-to-one>

		</composite-map-key>

		<element type="long">
			<column name="permissions" not-null="true" default="0"/>
		</element>
	</map>

	<!-- one-directional many-to-many association of Role to itself -->
	<list name="roles"
		table="sec_role_aggr_role"
		cascade="none"
	>
		<meta attribute="field-description">The Roles that this Role aggregates</meta>
		<meta attribute="use-in-tostring">true</meta>
		<key column="roleId" foreign-key="fk_RoleAggrRole__Role"/>
		<index column="sortOrder"/>
		<many-to-many class="RoleImpl" column="aggrRoleId" foreign-key="fk_RoleAggrRole__AggrRole"/>
	</list>


</class>

</hibernate-mapping>
